type: pipeline-template
version: 1

name: Spring Boot Gradle Git Multibranch Pipeline
displayName: Spring Boot Gradle Multibranch
description: Multibranch pipeline using template catalog
templateType: MULTIBRANCH

parameters:
  - name: repoUrl
    type: string
    displayName: Repository URL

  - name: gitCredentials
    type: credentials
    displayName: Git Credentials

multibranch:
  branchSource:
    git:
      remote: ${repoUrl}
      credentialsId: ${gitCredentials}
      traits:
        - gitBranchDiscovery
        - $class: 'CleanAfterCheckoutTrait'
        - $class: 'CleanBeforeCheckoutTrait'
        - $class: 'LocalBranchTrait'
        - headWildcardFilter:
            includes: main feature-* fix-*

  orphanedItemStrategy:
    numToKeep: 10

  buildStrategies:
    - pipelineTemplate:
        template: nodejs-kaniko-ci
